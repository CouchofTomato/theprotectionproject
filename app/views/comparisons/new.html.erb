<section class="section">
  <div class="columns" data-controller="comparison comparison-product comparison-export">
    <div class="column is-one-fifth">
      <h3 class="title is-3">Product Picker</h3>
      <div data-controller="health-comparison-product-select">
        <%= form_with url: comparison_products_path, format: 'json' do |form| %>
          <div class="field">
            <div class="control">
              <div class="select">
                <%= form.select "comparison_product[insurer]", options_from_collection_for_select(@insurers, "id", "name"), {prompt: 'Select Insurer...'}, data: {"health-comparison-product-select-target": 'insurer', "comparison-product-target": 'insurer', 'comparison-target': 'insurer', action: 'change->comparison#loadProducts'}, id: 'insurer-select' %>
              </div>
            </div>
          </div>
          <div class="field">
            <div class="control">
              <div class="select product-select">
                <%= form.select "comparison_product[product]", options_from_collection_for_select(@products || [], "id", "name"), {prompt: 'Select Product'}, data: { "health-comparison-product-select-target": 'product', "comparison-product-target": 'product', action: 'change->health-comparison-product-select#getProductModules' }, id: 'product-select' %>
              </div>
            </div>
          </div>
          <div class="field">
            <div id="product-modules" data-health-comparison-product-select-target="productModules" data-comparison-product-target="productModules">
            </div>
          </div>
          <div class="field">
            <div class="control">
              <%= form.submit "Load Benefits", class: 'button is-primary', data: { "health-comparison-product-select-target": 'comparisonProductSubmit', "comparison-product-target": 'comparisonProductSubmit', action: 'click->comparison-product#addComparisonProduct' } %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
    <div class="table-container column columns__column--no-padding-left">
      <table class="table">
        <tbody class="table__tbody--hidden">
          <tr data-comparison-product-target="productDetailsJSON" data-comparison-export-target="productDetailsJSON">
            <td></td>
          </tr>
        </tbody>
        <tbody>
          <tr>
            <th class="table--sticky-col table--fixed-col-width">Product Details</th>
          </tr>
        </tbody>
        <tbody>
          <tr data-comparison-product-target="insurerTableRow">
            <th class="table--sticky-col table--fixed-col-width">Insurer</th>
          </tr>
          <tr data-comparison-product-target="productTableRow">
            <th class="table--sticky-col table--fixed-col-width">Product</th>
          </tr>
          <tr data-comparison-product-target="chosenCoverRow">
            <th class="table--sticky-col table--fixed-col-width">Chosen Cover</th>
          </tr>
          <tr data-comparison-product-target="overallSumAssured">
            <th class="table--sticky-col table--fixed-col-width">Overall Sum Assured</th>
          </tr>
        </tbody>
          <% @benefit_categories.each do |category| %>
            <tbody>
              <tr>
                <th class="table--sticky-col table--fixed-col-width"><%= category.titleize %></th>
              </tr>
            </tbody>
            <tbody>
              <% @grouped_benefits[category].each do |benefit| %>
                <tr data-comparison-product-target="benefitRow" id=<%= benefit.id %>>
                  <td class="table--sticky-col table--fixed-col-width"><%= benefit.name.titleize %></td>
                </tr>
              <% end %>
            </tbody>
          <% end %>
      </table>
    </div>
    <div class="column is-2 has-text-centered">
      <h3 class="subtitle is-3">Options</h3>
      <label class="checkbox">
        <%= check_box_tag "covered_benefits", "covered_benefits", false, data: { "comparison-export-target": 'option' } %>
        Show only covered benefits
      </label>
      <h3 class="subtitle is-3">Export</h3>
      <button class="button is-large" data-action="click->comparison-export#excelExport">
        <span class="icon is-medium"><i class="fas fa-file-excel"></i></span>
      </button>
    </div>
  </div>
</section>
