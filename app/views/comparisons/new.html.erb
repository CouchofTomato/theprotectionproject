<section class="section">
  <div class="columns">
    <div class="column is-one-fifth">
      <h3 class="title is-3">Product Picker</h3>
      <div data-controller="health-comparison-product-select">
        <%= form_with(url: comparison_products_path) do |form| %>
          <div class="field">
            <div class="control">
              <div class="select">
                <%= form.select "comparison_product[insurer]", options_from_collection_for_select(Insurer.order(:name), "id", "name"), {prompt: 'Select Insurer...'}, data: {target: 'health-comparison-product-select.insurer', action: 'change->health-comparison-product-select#getProducts'}, id: 'insurer-select' %>
              </div>
            </div>
          </div>
          <div class="field">
            <div class="control">
              <div class="select product-select">
                <%= form.select "comparison_product[product]", options_for_select([]), {prompt: 'Select Product'}, data: { target: 'health-comparison-product-select.product', action: 'change->health-comparison-product-select#getProductModules' }, id: 'product-select' %>
              </div>
            </div>
          </div>
          <div class="field">
            <div id="product-modules" data-target="health-comparison-product-select.productModules">
            </div>
          </div>
          <div class="field">
            <div class="control">
              <%= form.submit "Load Benefits", class: 'button is-primary', data: { action: 'click->comparison-select#loadBenefits' } %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
    <div class="column">
      <table class="table">
        <tbody>
          <tr>
            <th colspan="100%">Product Details</th>
          </tr>
        </tbody>
        <tbody>
          <tr>
            <th>Insurer</th>
          </tr>
          <tr>
            <th>Product</th>
          </tr>
          <tr>
            <th>Chosen Cover</th>
          </tr>
          <tr>
            <th>Overall Sum Assured</th>
          </tr>
        </tbody>
          <% @benefit_categories.each do |category| %>
            <tbody>
              <tr>
                <th colspan="100%"><%= category.titleize %></th>
              </tr>
            </tbody>
            <tbody>
              <% @benefits[category].each do |benefit| %>
                <tr>
                  <td><%= benefit.name.titleize %></td>
                </tr>
              <% end %>
            </tbody>
          <% end %>
      </table>
    </div>
  </div>
</section>
